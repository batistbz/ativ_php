<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lista de Músicas</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-white p-8">
<div class="container mx-auto max-w-4xl">
<h1 class="text-4xl font-bold text-center bg-white text-pink-600 mb-8">Minhas Músicas</h1>
<div class="container mx-auto max-w-4xl">
  <div class="bg-pink-600 p-4 rounded-lg shadow-lg mb-8 flex items-center justify-between">
    <audio id="audio-player" src="" class="hidden"></audio>
    <div id="player-info" class="text-sm">
      <span class="font-bold" id="player-title">Nenhuma música selecionada</span>
      <span class="text-gray-400" id="player-artist"></span>
    </div>
    <div class="flex items-center gap-2">
      <!-- Botão anterior -->
      <button id="prev-button" class="bg-white hover:bg-white text-pink-600 font-bold py-2 px-4 rounded-full transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M6 6v12l8.5-6L6 6zm9 0v12h2V6h-2z"/>
        </svg>
      </button>

      <!-- Botão play -->
      <button id="play-button" class="bg-white hover:bg-white text-green-600 font-bold py-2 px-4 rounded-full transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </button>

      <!-- Botão pause -->
      <button id="pause-button" class="hidden bg-white hover:bg-white text-red-600 font-bold py-2 px-4 rounded-full transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
      </button>

      <!-- Botão próxima -->
      <button id="next-button" class="bg-white hover:bg-white text-pink-600 font-bold py-2 px-4 rounded-full transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M18 6v12l-8.5-6L18 6zm-11 0v12h-2V6h2z"/>
        </svg>
      </button>
    </div>
  </div>
    <!-- CAMPO DE BUSCA -->
    <div class="container mx-auto max-w-4xl">
    <div class="mb-4">
    <input type="search" id="search-input" placeholder="Buscar por título ou artista..."
    class="w-full p-2 rounded bg-white border border-pink-600 text-black placeholder-pink-300">
    </div>
    </div>

  <!-- TABELA -->
  <div class="bg-pink-600 p-6 rounded-lg shadow-lg">
    <table class="w-full text-left table-auto">
      <thead>
        <tr class="text-white">
          <th class="p-3 font-semibold">Título</th>
          <th class="p-3 font-semibold">Artista</th>
          <th class="p-3 font-semibold">Álbum</th>
        </tr>
      </thead>
      <tbody id="songs-table-body"></tbody>
    </table>
  </div>
</div>

<script>
const audioPlayer = document.getElementById('audio-player');
const playButton = document.getElementById('play-button');
const pauseButton = document.getElementById('pause-button');
const prevButton = document.getElementById('prev-button');
const nextButton = document.getElementById('next-button');
const playerTitle = document.getElementById('player-title');
const playerArtist = document.getElementById('player-artist');

let allSongs = [];
let currentIndex = -1; // Índice da música atual

async function fetchSongs() {
  const response = await fetch('http://localhost/ativ_php/player/src/list_songs.php');
  const result = await response.json();

  if (result.status === 'sucesso' && result.data.length > 0) {
    allSongs = result.data;
    const tableBody = document.getElementById('songs-table-body');
    tableBody.innerHTML = '';

    result.data.forEach(song => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="p-3">${song.titulo}</td>
        <td class="p-3">${song.artista}</td>
        <td class="p-3">${song.album || 'N/A'}</td>
        <td class="p-3">
          <button onclick="playSong(${song.id})" class="bg-teal-500 hover:bg-teal-600 text-white fontbold py-1 px-2 rounded text-xs transition-colors duration-200">
            Play
          </button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }
}
async function playSong(id) {
  currentIndex = allSongs.findIndex(s => s.id === id);
  if (currentIndex >= 0) {
    loadAndPlay(currentIndex);
  }
}
function loadAndPlay(index) {
  const song = allSongs[index];
  if (song) {
    audioPlayer.src = `../music_files/${song.caminho_arquivo}`;
    audioPlayer.play();
    playerTitle.textContent = song.titulo;
    playerArtist.textContent = `- ${song.artista}`;
    playButton.classList.add('hidden');
    pauseButton.classList.remove('hidden');
  }
}
function pauseSong() {
  audioPlayer.pause();
  playButton.classList.remove('hidden');
  pauseButton.classList.add('hidden');
}
function playPrevious() {
  if (allSongs.length > 0) {
    currentIndex = (currentIndex - 1 + allSongs.length) % allSongs.length;
    loadAndPlay(currentIndex);
  }
}
function playNext() {
  if (allSongs.length > 0) {
    currentIndex = (currentIndex + 1) % allSongs.length;
    loadAndPlay(currentIndex);
  }
}
playButton.addEventListener('click', () => {
  audioPlayer.play();
  playButton.classList.add('hidden');
  pauseButton.classList.remove('hidden');
});
pauseButton.addEventListener('click', pauseSong);
prevButton.addEventListener('click', playPrevious);
nextButton.addEventListener('click', playNext);
document.addEventListener('DOMContentLoaded', fetchSongs);

    async function fetchSongs(searchTerm = '') {
    let url = 'http://localhost/ativ_php/player/src/list_songs.php';
    if (searchTerm) {
    url += `?search=${searchTerm}`;
    }
    const response = await fetch(url);
    const result = await response.json();
    // ... lógica de renderização da tabela ...
    }
    document.addEventListener('DOMContentLoaded', () => {
    fetchSongs();
    document.getElementById('search-input').addEventListener('input', (event) => {
    fetchSongs(event.target.value);
    });
    });
</script>
</body>
</html>
